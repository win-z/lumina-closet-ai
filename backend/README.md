# Lumina Closet AI Backend

Lumina Closet AI çš„åç«¯ API æœåŠ¡ï¼Œæä¾›å®Œæ•´çš„è¡£æ©±ç®¡ç†ã€AIç©¿æ­å»ºè®®ã€è™šæ‹Ÿè¯•ç©¿ç­‰åŠŸèƒ½ã€‚

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Lumina Closet AI åº”ç”¨æ¶æ„                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å‰ç«¯ (React + TypeScript + Vite)                               â”‚
â”‚  â”œâ”€â”€ è¡£æ©±ç®¡ç† | AIç©¿æ­å»ºè®® | è™šæ‹Ÿè¯•ç©¿ | æ—¥è®° | æ•°æ®åˆ†æ          â”‚
â”‚  â””â”€â”€ IndexedDB (æœ¬åœ°ç¼“å­˜)                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTP REST API
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åç«¯ (Node.js + Express + SQLite)                              â”‚
â”‚  â”œâ”€â”€ è®¤è¯ä¸­é—´ä»¶ (JWT)                                            â”‚
â”‚  â”œâ”€â”€ RESTful API Routes                                          â”‚
â”‚  â”œâ”€â”€ ä¸šåŠ¡é€»è¾‘å±‚ (Services)                                       â”‚
â”‚  â””â”€â”€ æ•°æ®è®¿é—®å±‚ (Repository/Models)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¤–éƒ¨AIæœåŠ¡                                                       â”‚
â”‚  â”œâ”€â”€ Google Gemini (æ–‡æœ¬ç”Ÿæˆ/å›¾åƒè¯†åˆ«)                           â”‚
â”‚  â””â”€â”€ è±†åŒ… Doubao (è™šæ‹Ÿè¯•ç©¿ç”Ÿæˆ)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd backend
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¤ºä¾‹é…ç½®æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥å®é™…é…ç½®
```

### 3. åˆå§‹åŒ–æ•°æ®åº“

```bash
npm run db:init
```

### 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

æœåŠ¡å™¨å°†åœ¨ `http://localhost:3000` å¯åŠ¨ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/           # é…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ index.ts      # ç¯å¢ƒå˜é‡åŠ è½½
â”‚   â”œâ”€â”€ controllers/      # æ§åˆ¶å™¨å±‚
â”‚   â”œâ”€â”€ middleware/       # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ auth.ts       # JWTè®¤è¯
â”‚   â”‚   â”œâ”€â”€ errorHandler.ts  # é”™è¯¯å¤„ç†
â”‚   â”‚   â””â”€â”€ validation.ts   # è¯·æ±‚éªŒè¯
â”‚   â”œâ”€â”€ models/           # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ UserModel.ts
â”‚   â”‚   â”œâ”€â”€ BodyProfileModel.ts
â”‚   â”‚   â”œâ”€â”€ ClothingItemModel.ts
â”‚   â”‚   â””â”€â”€ DiaryEntryModel.ts
â”‚   â”œâ”€â”€ routes/           # APIè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ auth.ts       # è®¤è¯è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ users.ts      # ç”¨æˆ·è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ wardrobe.ts   # è¡£æ©±è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ diary.ts      # æ—¥è®°è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ analytics.ts  # åˆ†æè·¯ç”±
â”‚   â”‚   â””â”€â”€ ai.ts         # AIåŠŸèƒ½è·¯ç”±
â”‚   â”œâ”€â”€ services/         # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ gemini.ts     # Google Gemini æœåŠ¡
â”‚   â”‚   â””â”€â”€ doubao.ts     # è±†åŒ… AI æœåŠ¡
â”‚   â”œâ”€â”€ types/            # ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ utils/            # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ helper.ts
â”‚   â”‚   â””â”€â”€ logger.ts
â”‚   â””â”€â”€ server.ts         # åº”ç”¨å…¥å£
â”œâ”€â”€ database/             # SQLiteæ•°æ®åº“æ–‡ä»¶
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ .env.example
```

## ğŸ”‘ API æ–‡æ¡£

### è®¤è¯æ¥å£

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| POST | `/api/auth/register` | ç”¨æˆ·æ³¨å†Œ |
| POST | `/api/auth/login` | ç”¨æˆ·ç™»å½• |
| POST | `/api/auth/refresh` | åˆ·æ–°Token |
| POST | `/api/auth/logout` | é€€å‡ºç™»å½• |

### ç”¨æˆ·æ¥å£

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| GET | `/api/users/profile` | è·å–ç”¨æˆ·æ¡£æ¡ˆ |
| PUT | `/api/users/profile` | æ›´æ–°ç”¨æˆ·æ¡£æ¡ˆ |
| GET | `/api/users/stats` | è·å–ç”¨æˆ·ç»Ÿè®¡ |

### è¡£æ©±æ¥å£

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| GET | `/api/wardrobe` | è·å–è¡£æ©±åˆ—è¡¨ |
| POST | `/api/wardrobe` | æ·»åŠ å•å“ |
| GET | `/api/wardrobe/:id` | è·å–å•å“è¯¦æƒ… |
| PUT | `/api/wardrobe/:id` | æ›´æ–°å•å“ |
| DELETE | `/api/wardrobe/:id` | åˆ é™¤å•å“ |

### æ—¥è®°æ¥å£

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| GET | `/api/diary` | è·å–æ—¥è®°åˆ—è¡¨ |
| POST | `/api/diary` | åˆ›å»ºæ—¥è®° |
| GET | `/api/diary/:id` | è·å–æ—¥è®°è¯¦æƒ… |
| PUT | `/api/diary/:id` | æ›´æ–°æ—¥è®° |
| DELETE | `/api/diary/:id` | åˆ é™¤æ—¥è®° |

### AIæ¥å£

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| POST | `/api/ai/auto-tag` | æœè£…å›¾åƒè‡ªåŠ¨æ ‡ç­¾ |
| POST | `/api/ai/outfit` | AIç©¿æ­å»ºè®® |
| POST | `/api/ai/try-on` | è™šæ‹Ÿè¯•ç©¿ |
| POST | `/api/ai/analyze` | è¡£æ©±å¥åº·åˆ†æ |

## ğŸ› ï¸ å¼€å‘å‘½ä»¤

```bash
# å¼€å‘æ¨¡å¼å¯åŠ¨
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm start

# åˆå§‹åŒ–æ•°æ®åº“
npm run db:init
```

## ğŸ“ ç¯å¢ƒå˜é‡

| å˜é‡ | æè¿° | é»˜è®¤å€¼ |
|------|------|--------|
| PORT | æœåŠ¡ç«¯å£ | 3000 |
| NODE_ENV | ç¯å¢ƒ | development |
| JWT_SECRET | JWTå¯†é’¥ | - |
| JWT_EXPIRES_IN | Tokenæœ‰æ•ˆæœŸ(å°æ—¶) | 720 |
| DB_PATH | æ•°æ®åº“è·¯å¾„ | ./database/lumina.db |
| GEMINI_API_KEY | Google Gemini API Key | - |
| DOUBAO_API_KEY | è±†åŒ… API Key | - |
| CORS_ORIGIN | å…è®¸çš„è·¨åŸŸæ¥æº | http://localhost:5173 |

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- JWT Token è®¤è¯
- å¯†ç  SHA256 å“ˆå¸Œ
- è¯·æ±‚é€Ÿç‡é™åˆ¶
- Helmet å®‰å…¨å¤´
- è¾“å…¥éªŒè¯ (Zod)
- SQL æ³¨å…¥é˜²æŠ¤ (å‚æ•°åŒ–æŸ¥è¯¢)

## ğŸ“„ è®¸å¯è¯

MIT
